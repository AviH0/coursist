{% extends "master.html" %}
{% load static %}
{% load custom_tags %}

<p id="invisibleClickable"></p>
{% block head %}
    <script src={% static 'scripts/handlebars.js' %}></script>

    <script name="course-single" type="text/x-handlebars-template">
        {% raw_include 'courses/course-item.html' %}
    </script>
    <script>
        function renderSearchResults(courses) {
            let newContent = "";
            courses.forEach((course) => {
                newContent += hb_templates["course-single"]({
                    "course": course,
                    "arrow_url": "{% static 'images/arrow.svg' %}"
                });
            });
            $("#courses-list").html(newContent);
        }

        onReady(() => {
            bindButton("search_btn",
                () => {
                    hide("courses-list");
                    let free_text = $("#course_id").val();
                    let school = $("#faculty").val();
                    let faculty = $("#hug").val();
                    return {"free_text": free_text, "school": school, "faculty": faculty};
                },
                (response) => {
                    const courses = response["courses"];
                    console.log(`Got ${courses.length} courses`);

                    show("courses-list", () => {
                        renderSearchResults(courses);
                    });
                },
                (response) => {
                },
                '{{ csrf_token }}');
        });
    </script>
{% endblock %}

{% block content_header %}
    <div class="text-white text-center d-flex align-items-center py-5 px-4">
        <div class="container">
            <br><br>
            <div class="row">
                <div class="col-md-4">
                    <div class="search-param-wrapper">
                        <div class="title">
                            פקולטה
                        </div>
                        <div class="mt-3">
                            <input type="text" name="faculty" id="faculty" class="search-input"
                                   placeholder="הקלידו שם פקולטה" value="מדעי המחשב"/>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="search-param-wrapper">
                        <div class="title">
                            חוג
                        </div>
                        <div class="mt-3">
                            <input type="text" name="hug" id="hug" class="search-input" placeholder="הקלידו שם חוג"/>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="search-param-wrapper">
                        <div class="title">
                            סמסטר
                        </div>
                        <div class="mt-3">
                            <input type="text"
                                   name="semester"
                                   id="semester"
                                   class="search-input"
                                   placeholder="סמסטר א' או ב'"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row mt-5">
                <div class="col-sm-12">
                    <input type="text"
                           name="course_name"
                           id="course_id"
                           class="course-name-input"
                           placeholder=" חיפוש חופשי"/>
                    <button type="button" class="search-btn" id="search_btn">
                        <img alt="search" src="{% static 'images/search.svg' %}">
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
                //document.getElementById("search_btn").click();
                //...get the button
                // Cancel the default action, if needed
                jQuery(function () {
                    jQuery('#search_btn').click();
                });
            }
        );
        // Execute a function when the user releases a key on the keyboard
        document.addEventListener("keydown", function (event) {
            // Number 13 is the "Enter" key on the keyboard
            if (event.keyCode === 13) {
                // Cancel the default action, if needed
                event.preventDefault();
                // Trigger the button element with a click
                document.getElementById("search_btn").click();
            }
        });
    </script>
{% endblock %}

{% block content_body %}
    <div class="container" id="courses-list">
    </div>
{% endblock %}

